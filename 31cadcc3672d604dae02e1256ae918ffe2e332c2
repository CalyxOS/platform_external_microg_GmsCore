{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "cba24637_9971fc45",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1000062
      },
      "writtenOn": "2023-11-02T17:16:00Z",
      "side": 1,
      "message": "Oddly, with this change, com.google.android.gms_preferences.xml only contains calyx_prefs_version after a new install, not exposure_last_cleanup like it usually does. A reboot or restart of microG does cause exposure_last_cleanup to appear, but this is odd. Should check into this.",
      "revId": "31cadcc3672d604dae02e1256ae918ffe2e332c2",
      "serverId": "35266860-6252-469c-a67d-185064479fc0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "1f764345_f575b6f9",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1000062
      },
      "writtenOn": "2023-11-02T18:12:45Z",
      "side": 1,
      "message": "This must have been my confusion, or something may have changed. I tried without this patch, too (used the version CalyxOS is shipping); exposure_last_cleanup is added on boot apparently, but clearing or restarting microG is not enough; I was wrong when mentioning that in the above comment.\n\nOn-boot is still a decent guarantee that exposure_last_cleanup would be available for everyone with an existing install; however, we\u0027ve enhanced the checks now anyway, so we don\u0027t need to rely on that.",
      "parentUuid": "cba24637_9971fc45",
      "revId": "31cadcc3672d604dae02e1256ae918ffe2e332c2",
      "serverId": "35266860-6252-469c-a67d-185064479fc0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "467b244a_48703212",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1000062
      },
      "writtenOn": "2023-11-02T19:01:12Z",
      "side": 1,
      "message": "Without a corresponding SUW change, new installs with this change will have location features off if /product/etc/microg.xml is not present. (Existing installs should migrate okay.) Still doing full testing though.",
      "revId": "31cadcc3672d604dae02e1256ae918ffe2e332c2",
      "serverId": "35266860-6252-469c-a67d-185064479fc0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "a47deb77_38950484",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1000062
      },
      "writtenOn": "2023-11-02T21:22:15Z",
      "side": 1,
      "message": "Best to combine with I9dc049a0.\n\nTESTING\n\nI performed all of the tests below and the behavior was as described. At this point I\u0027m confident this change works as desired. Notably we do not include \"Request from Hotspot\" as a default so it will always be off unless the user turns it on. We can always have it default enabled later, but the focus of this change was matching existing behavior for this migration.\n\nExpected default prefs: checkin_enable_service\u003dtrue, gcm_enable_mcs_service\u003dtrue, location_wifi_learning\u003dtrue, location_cell_learning\u003dtrue, location_wifi_mls\u003dtrue, location_cell_mls\u003dtrue, location_geocoder_nominatim\u003dtrue\nPrefs file: /data/user/0/com.google.android.gms/shared_prefs/com.google.android.gms_preferences.xml\nAll tests with this change should be performed *without /product/etc/microg.xml present* for the microG Settings to reflect what is described, but the prefs file will be as described either way.\n\nTests:\n1. (Clean install test.) Perform clean install including this change. Before proceeding with SUW, check prefs file. It should contain calyx_prefs_version\u003d1, exposure_last_cleanup, and nothing else -- whether or not /product/etc/microg.xml is present. (There will also not be any other shared_prefs files present.) Proceed with SUW, with or without networking (doesn\u0027t matter), up to the microG page. Turn off the top toggle (which turns them all off), tap Next, and check the prefs file again. It should be the same. Go back and turn on the top toggle, turn OFF the notifications toggle and location toggles, then Next. It will now additionally contain the location prefs from the defaults above as false, and some other new prefs that are all either 0 or false (including gcm_enable_mcs_service\u003dfalse). Go back and turn on the notification toggle, then Next. Now checkin_enable_service\u003dtrue and gcm_enable_mcs_service\u003dtrue should be in the prefs file. Finally, go back and turn on the location toggle, then Next. All the default values from above should be set as true. Proceed through the install, open up microG Settings, and verify that everything is turned on as expected.\n2. (Upgrade test, SUW defaults, microG never opened.) Prior to upgrade, use a build without this change, in which the SUW was completed with defaults, and microG Settings was never opened. Check prefs file. It will be missing checkin_enable_service\u003dtrue and missing the location prefs from the defaults above; the only item listed as true should be gcm_enable_mcs_service. Upgrade to a build with this change. Still don\u0027t open microG Settings. Check prefs file. It should now contain calyx_prefs_version\u003d1 along with all of the expected default prefs above. Now open microG Settings. Confirm everything looks as expected.\n3. (Upgrade test, SUW microG options turned off, no microG to be opened.) Prior to upgrade, use a build without this change, in which the SUW was completed with microG toggles turned off. Check prefs file. It should not contain any of the expected default prefs at all. Upgrade to a build with this change. Check prefs file. It should not have changed at all, since microG was disabled and not allowed to run.\n4. (Upgrade test, SUW microG defaults, then microG opened and all turned off.) Prior to upgrade, have a build with microG without this change, in which the SUW was completed with defaults, but then microG Settings was opened and everything was turned off. Check prefs file. All the default prefs should be present but false instead of true. Upgrade to a build with this change. Check prefs file. Should have calyx_prefs_version\u003d1 but otherwise be the same. Open microG Settings. Everything should still be turned off.\n5. (Upgrade test, SUW microG *no notifications*, microG never opened.) Prior to upgrade, have a build with microG without this change, in which the SUW was completed with the microG push notification option turned off, and microG Settings was never opened. Check prefs file. It should not contain any of the expected default prefs as true, but will contain many values as false or 0. Upgrade to a build with this change. Still don\u0027t open microG Settings. Check prefs file. It should now contain calyx_prefs_version\u003d1 along with the location prefs from the defaults above as true. Now open microG Settings. Confirm everything looks as expected (everything off except the location settings).",
      "revId": "31cadcc3672d604dae02e1256ae918ffe2e332c2",
      "serverId": "35266860-6252-469c-a67d-185064479fc0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "950d47ef_642f0c25",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1000062
      },
      "writtenOn": "2023-11-02T21:22:49Z",
      "side": 1,
      "message": "Done here: I9dc049a0",
      "parentUuid": "467b244a_48703212",
      "revId": "31cadcc3672d604dae02e1256ae918ffe2e332c2",
      "serverId": "35266860-6252-469c-a67d-185064479fc0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "d6a00497_004e230d",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1000062
      },
      "writtenOn": "2023-11-02T21:26:25Z",
      "side": 1,
      "message": "With this, /product/etc/microg.xml can be removed (a separate change)\n\n(Adding this comment because I don\u0027t want to forget)",
      "revId": "31cadcc3672d604dae02e1256ae918ffe2e332c2",
      "serverId": "35266860-6252-469c-a67d-185064479fc0"
    }
  ]
}